{% load opencve_extras %}

{% if vendors_dict %}
<table class="table table-striped table-bordered">
    <thead>
    <th>Vendors</th>
    <th>Products</th>
    </thead>
    <tbody>
    {% for vendor, products in vendors_dict.items %}
    <tr>
        <td>
            <div class="vendor-item">
                <span class="vendor-name">{{ vendor | humanize }}</span>
                {% if user.is_authenticated and vendors_data_dict %}
                    {% with vendor_data=vendors_data_dict|get:vendor %}
                    <button class="btn btn-default btn-xs subscribe-vendor"
                            data-vendor-id="{{ vendor_data.vendor.id }}"
                            data-vendor-name="{{ vendor }}"
                            type="button">
                        <i class="fa fa-bell-o"></i> {% if vendor_data.subscription_count > 0 %}Subscribed ({{ vendor_data.subscription_count }}){% else %}Subscribe{% endif %}
                    </button>
                    {% endwith %}
                {% else %}
                    <a href="{% url 'account_signup' %}" class="btn btn-default btn-xs">
                        <i class="fa fa-bell-o"></i> Subscribe
                    </a>
                {% endif %}
            </div>
        </td>
        <td>
            <div class="product-list">
                {% for product in products %}
                <div class="product-item">
                    <span class="product-name">{{ product | humanize }}</span>
                    {% if user.is_authenticated and vendors_data_dict %}
                        {% with vendor_data=vendors_data_dict|get:vendor %}
                            {% with products_dict=vendor_data.products %}
                                {% with product_obj=products_dict|get:product %}
                                <button class="btn btn-default btn-xs subscribe-product"
                                        data-vendor-id="{{ vendor_data.vendor.id }}"
                                        data-vendor-name="{{ vendor }}"
                                        data-product-id="{{ product_obj.product.id }}"
                                        data-product-name="{{ product }}"
                                        type="button">
                                    <i class="fa fa-bell-o"></i> {% if product_obj.subscription_count > 0 %}Subscribed ({{ product_obj.subscription_count }}){% else %}Subscribe{% endif %}
                                </button>
                                {% endwith %}
                            {% endwith %}
                        {% endwith %}
                    {% else %}
                        <a href="{% url 'account_signup' %}" class="btn btn-default btn-xs">
                            <i class="fa fa-bell-o"></i> Subscribe
                        </a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p class="alert alert-info">No data.</p>
{% endif %}
